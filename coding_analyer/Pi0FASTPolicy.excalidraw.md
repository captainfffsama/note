---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'


# Excalidraw Data

## Text Elements
Pi0-Fast lerobot实现解析 ^KjvxZ3t7

PI0FASTPolicy ^84aVQnIw

处理图片
self.prepare_images ^tsGyhbR0

处理STATE
create_input_tokens ^I9Uqv2ni

1. 对STATE分bin

2. 生成两段文本：prefix带有 “Task: …, State: …” 的前缀描述，state_text仅包含 “State: …”；这一步为模型提供了上下文信息与当前环境状态。

3. prefix 文本token化

4. 先对动作做 min-max 归一化并补齐到固定维度，再通过一个“fast”分词器生成临时的 act_ids 与 act_mask，随后将它们映射回 paligemma 的词表索引。为了构造完整的动作输入，还会手动拼接 BOS（句首）和 EOS（句尾）token，并用 torch.where 将非有效动作用 PAD token 填充。

5. token_type_ids标注每个token是前缀还是后缀
 ^KX8A9C9r

%%
## Drawing
```compressed-json
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=
```
%%